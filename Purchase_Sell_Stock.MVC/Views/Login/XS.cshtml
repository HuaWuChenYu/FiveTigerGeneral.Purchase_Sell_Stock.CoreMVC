
@{
    Layout = null;
}

<!DOCTYPE html>
<script src="~/lib/jquery/dist/jquery.js"></script>
<link href="~/StyleSheet.css" rel="stylesheet" />
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>XS</title>
</head>
<body>
    <div class="container">

        <div class="row">
            <div class="col-md-offset-3 col-md-6">
                <form class="form-horizontal" action="user" method="post" id="admin">
                    <input type="hidden" name="actionName" value="login">
                    <span class="heading"><font color="#4F4F4F">用户登录</font> </span>
                    <div class="form-group">
                        <input type="text" name="userphone" class="form-control" id="inputEmail" placeholder="手机号">
                        <i class="fa fa-user"></i>
                    </div>
                    <div class="form-group help">
                        <input type="text" name="YZM" class="form-control" id="pwd" placeholder="验证码">

                        
                        <button type="button" class="btn btn-default" id="find">点击获取验证码</button>
                        <i class="fa fa-lock"></i>
                        <a href="#" class="fa fa-question-circle"></a>
                    </div>
                    <div class="form-group">
                        <div class="main-checkbox">
                            <input type="checkbox" name="check" id="checkbox1" value="null">
                            <label for="checkbox1"></label>
                        </div>
                        <span class="text">记住我</span>
                        <button type="button" class="btn btn-default" id="asubmit">登录</button>
                        <div>
                            <a class="layui-btn layui-btn-normal" href="/Login/Index">忘记密码</a>
                            <a class="layui-btn layui-btn-normal" href="/Login/Index">注册</a>
                        </div>
                    </div>
                </form>

            </div>

        </div>
    </div>
</body>
</html>
<script>
    var countdown = 120;

    //倒计时按钮
    $('#find').click(function () {
        var pone = $("#YH").val();
        let count = 60;
        const countDown = setInterval(() => {
            if (count === 0) {
                $('#find').val('重新发送').removeAttr('disabled');
                $('#find').css({
                    background: '#ff9400',
                    color: '#fff',
                });
                clearInterval(countDown);
            } else {
                $('#find').attr('disabled', true);
                $('#find').css({
                    background: '#d8d8d8',
                    color: '#707070',
                });
                $('#find').val(count + '秒后可重新获取');
            }
            count--;
        }, 1000);
        var partten = /^1[3,5,8,9,7]\d{9}$/;
        //判断手机号格式是否合格
        if (partten.test(phone)) {

            $("#tishi").text(" ");
            //使用ajax发送数据
            $.ajax({
                url: "/default/Page_Load?mobile=" + phone,
                type: "get",
                dataType: "text",
                success: function (d) {
                    //将返回的验证码放入隐藏域
                    $("#ss").val(d);
                }
            })
        }
        else {
            $("#tishi").text("手机格式不正确");
            return;
        }
    });
    //监听提交
    form.on('submit(asubmit)', function (data) {
        $.ajax({
            url: 'http://localhost:49760/api/Logins',
            type: 'get',
            data: { name: data.name, pwd: data.pwd },
            success: function (d) {
                if (d > 0) {
                    layer.alert("登录成功", { icon: 6, time: 2000 });
                    location.href = '/Goods/Index';
                }
                else {
                    layer.msg("登录失败");
                }
            }
        })
        return false;
    });
    
</script>
